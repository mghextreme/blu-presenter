name: Build API and APP

on:
  push:
    branches: [ "master" ]
    paths:
      - 'api/**'
      - 'app/**'
  pull_request:
    branches: [ "master" ]
    paths:
      - 'api/**'
      - 'app/**'

jobs:

  build-api:
    name: Build API
    runs-on: ubuntu-latest
    if: contains(github.event.pull_request.files.*.path, 'api/')

    steps:
    - uses: actions/checkout@v4

    - name: Set up pnpm
      uses: pnpm/action-setup@v3
      with:
        version: 10

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 24
        cache: 'pnpm'
        cache-dependency-path: ./api/pnpm-lock.yaml

    - name: Install dependencies
      working-directory: ./api
      run: pnpm install

    - name: Build API
      working-directory: ./api
      run: pnpm build

  build-app:
    name: Build App
    runs-on: ubuntu-latest
    if: contains(github.event.pull_request.files.*.path, 'app/')

    steps:
    - uses: actions/checkout@v4

    - name: Set up pnpm
      uses: pnpm/action-setup@v3
      with:
        version: 10

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 24
        cache: 'pnpm'
        cache-dependency-path: ./app/pnpm-lock.yaml

    - name: Install dependencies
      working-directory: ./app
      run: pnpm install

    - name: Build App
      working-directory: ./app
      run: pnpm build
